# Signal Protocol å®ç° ğŸ”’

è¿™æ˜¯ä¸€ä¸ªç”¨äºæ·±å…¥å­¦ä¹ å’Œç†è§£ Signal Protocol ç«¯åˆ°ç«¯åŠ å¯†åè®®çš„ Python å®ç°é¡¹ç›®ã€‚Signal Protocol æ˜¯ç›®å‰æœ€å…ˆè¿›çš„ç«¯åˆ°ç«¯åŠ å¯†é€šä¿¡åè®®ï¼Œè¢«å¹¿æ³›åº”ç”¨äº Signalã€WhatsAppã€Facebook Messenger ç­‰ä¸»æµé€šä¿¡åº”ç”¨ä¸­ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

- **æ·±åº¦å­¦ä¹ **: é€šè¿‡å®Œæ•´å®ç°ç†è§£ Signal Protocol çš„æ ¸å¿ƒåŸç†å’ŒæŠ€æœ¯ç»†èŠ‚
- **æ¨¡å—åŒ–è®¾è®¡**: é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åŒ–æ¶æ„ï¼Œä¾¿äºå­¦ä¹ å’Œæ‰©å±•
- **å®Œæ•´æµ‹è¯•**: æ¯ä¸ªç»„ä»¶éƒ½æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿å®ç°æ­£ç¡®æ€§
- **è¯¦ç»†æ–‡æ¡£**: æä¾›è¯¦ç»†çš„å¼€å‘è¿‡ç¨‹æ–‡æ¡£å’ŒæŠ€æœ¯è¯´æ˜

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
signal_protocol/
â”œâ”€â”€ keys/                    # å¯†é’¥ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ base_key.py         # åŸºç¡€å¯†é’¥ç±»å’Œ Curve25519 å®ç°
â”‚   â”œâ”€â”€ identity_key.py     # èº«ä»½å¯†é’¥å’Œ XEdDSA ç­¾å
â”‚   â”œâ”€â”€ key_store.py        # å¯†é’¥å­˜å‚¨å’Œç®¡ç†
â”‚   â””â”€â”€ pre_keys/           # é¢„å¯†é’¥å­ç³»ç»Ÿ
â”‚       â”œâ”€â”€ base_pre_key.py     # åŸºç¡€é¢„å¯†é’¥
â”‚       â”œâ”€â”€ signed_pre_key.py   # ç­¾åé¢„å¯†é’¥
â”‚       â”œâ”€â”€ one_time_pre_key.py # ä¸€æ¬¡æ€§é¢„å¯†é’¥
â”‚       â””â”€â”€ pre_key_bundle.py   # é¢„å¯†é’¥åŒ…
â”œâ”€â”€ sessions/               # ä¼šè¯ç®¡ç†æ¨¡å— (è®¡åˆ’ä¸­)
â”œâ”€â”€ messages/               # æ¶ˆæ¯åŠ å¯†/è§£å¯†æ¨¡å— (è®¡åˆ’ä¸­)
â””â”€â”€ tests/                  # å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
```

## âœ¨ å½“å‰å®ç°åŠŸèƒ½

### ğŸ”‘ å¯†é’¥ç®¡ç†ç³»ç»Ÿ

#### æ ¸å¿ƒå¯†é’¥åŸºç¡€è®¾æ–½
- **Curve25519 å¯†é’¥ç”Ÿæˆ**: å®ç°äº†æ ‡å‡†çš„ Curve25519 ECDH å¯†é’¥å¯¹ç”Ÿæˆ
- **å¯†é’¥é’³åˆ¶ (Key Clamping)**: æ­£ç¡®å®ç° Curve25519 ç§é’¥çš„ä½æ“ä½œè¦æ±‚
- **å¤šç§å®ç°å¯¹æ¯”**: æä¾› PyNaCl å®˜æ–¹å®ç°å’Œæ‰‹åŠ¨å®ç°çš„æ€§èƒ½å¯¹æ¯”

#### èº«ä»½å¯†é’¥ (Identity Keys)
- **IdentityKeyPair**: é•¿æœŸèº«ä»½å¯†é’¥å¯¹ï¼Œç”¨äºèº«ä»½éªŒè¯
- **XEdDSA ç­¾å**: Ed25519 å…¼å®¹ç­¾åï¼Œä½¿ç”¨ Curve25519 å¯†é’¥
- **å¯†é’¥åºåˆ—åŒ–**: æ”¯æŒå¯†é’¥çš„æŒä¹…åŒ–å­˜å‚¨å’Œæ¢å¤
- **Ed25519 éªŒè¯å¯†é’¥**: è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ Ed25519 éªŒè¯å¯†é’¥

#### é¢„å¯†é’¥ç³»ç»Ÿ (Pre-Keys)
- **åŸºç¡€é¢„å¯†é’¥ (PreKey)**: ç”¨äºåˆå§‹å¯†é’¥äº¤æ¢çš„ä¸´æ—¶å¯†é’¥
- **ç­¾åé¢„å¯†é’¥ (SignedPreKey)**: å¸¦æœ‰èº«ä»½å¯†é’¥ç­¾åçš„é¢„å¯†é’¥ï¼Œæä¾›å‰å‘å®‰å…¨æ€§
- **ä¸€æ¬¡æ€§é¢„å¯†é’¥ (OneTimePreKey)**: ç”¨äºç¡®ä¿å®Œç¾å‰å‘å®‰å…¨æ€§çš„å•æ¬¡ä½¿ç”¨å¯†é’¥
- **é¢„å¯†é’¥åŒ… (PreKeyBundle)**: å®Œæ•´çš„å¯†é’¥äº¤æ¢ä¿¡æ¯åŒ…

#### å¯†é’¥å­˜å‚¨ (Key Storage)
- **æŒä¹…åŒ–å­˜å‚¨**: åŸºäºæ–‡ä»¶çš„å¯†é’¥å­˜å‚¨ç³»ç»Ÿ
- **å®‰å…¨åºåˆ—åŒ–**: å®‰å…¨çš„å¯†é’¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–
- **å¯†é’¥ç®¡ç†**: æ”¯æŒå¯†é’¥çš„ä¿å­˜ã€åŠ è½½ã€åˆ é™¤ç­‰æ“ä½œ

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Python 3.11+**: ç°ä»£ Python ç‰¹æ€§å’Œç±»å‹æç¤º
- **PyNaCl**: é«˜æ€§èƒ½çš„ NaCl/libsodium åŠ å¯†åº“
- **Cryptography**: ç”¨äºé«˜çº§åŠ å¯†æ“ä½œ
- **æ—¶é—´æˆ³ç®¡ç†**: æ¯«ç§’çº§æ—¶é—´æˆ³ç”¨äºå¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd Signal-Protocol

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# æˆ–è€… .venv\\Scripts\\activate  # Windows

# å®‰è£…ä¾èµ–
pip install pynacl cryptography
```

### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

```python
from signal_protocol.keys.identity_key import generate_identity_key_pair
from signal_protocol.keys.pre_keys.base_pre_key import generate_pre_key_pair
from signal_protocol.keys.pre_keys.signed_pre_key import generate_signed_pre_key_pair
from signal_protocol.keys.pre_keys.pre_key_bundle import create_pre_key_bundle

# 1. ç”Ÿæˆèº«ä»½å¯†é’¥å¯¹
identity_key_pair = generate_identity_key_pair()
print(f"èº«ä»½å¯†é’¥ç”Ÿæˆå®Œæˆ")

# 2. ç”Ÿæˆé¢„å¯†é’¥
pre_key_pair = generate_pre_key_pair(key_id=1)
print(f"é¢„å¯†é’¥ ID: {pre_key_pair.key_id}")

# 3. ç”Ÿæˆç­¾åé¢„å¯†é’¥
signed_pre_key_pair = generate_signed_pre_key_pair(identity_key_pair, key_id=1)
print(f"ç­¾åé¢„å¯†é’¥æ—¶é—´æˆ³: {signed_pre_key_pair.timestamp}")

# 4. åˆ›å»ºé¢„å¯†é’¥åŒ… (ç”¨äºå¯†é’¥äº¤æ¢)
pre_key_bundle = create_pre_key_bundle(
    registration_id=12345,
    device_id=1,
    pre_key_pair=pre_key_pair,
    signed_pre_key_pair=signed_pre_key_pair,
    signed_pre_key_signature=signature,
    identity_key_pair=identity_key_pair
)
print("é¢„å¯†é’¥åŒ…åˆ›å»ºå®Œæˆ")
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m unittest discover tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m unittest tests.test_identity_key -v
python -m unittest tests.test_pre_key -v
```

### æ¨¡å—æ‰§è¡Œå’Œè°ƒè¯•

```bash
# ç›´æ¥è¿è¡Œæ¨¡å—è¿›è¡Œæµ‹è¯•
python -m signal_protocol.keys.pre_keys.base_pre_key
python -m signal_protocol.keys.pre_keys.signed_pre_key
python -m signal_protocol.keys.pre_keys.one_time_pre_key

# æŠ‘åˆ¶è¿è¡Œæ—¶è­¦å‘Šï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰
python -W ignore::RuntimeWarning -m signal_protocol.keys.pre_keys.base_pre_key
```

## ğŸ§ª å¼€å‘å’Œæµ‹è¯•

### VS Code è°ƒè¯•æ”¯æŒ

é¡¹ç›®åŒ…å«å®Œæ•´çš„ VS Code è°ƒè¯•é…ç½®ï¼š

1. **Python: Current File** - è°ƒè¯•å½“å‰æ‰“å¼€çš„æ–‡ä»¶
2. **Python Module: Auto-detect Current File** - è‡ªåŠ¨æ£€æµ‹å¹¶è°ƒè¯•å½“å‰æ–‡ä»¶å¯¹åº”çš„æ¨¡å—
3. **Python: pytest** - è¿è¡Œå’Œè°ƒè¯•æµ‹è¯•

### æµ‹è¯•è¦†ç›–èŒƒå›´

- âœ… **èº«ä»½å¯†é’¥æµ‹è¯•**: å¯†é’¥ç”Ÿæˆã€XEdDSA ç­¾åéªŒè¯ã€åºåˆ—åŒ–
- âœ… **é¢„å¯†é’¥æµ‹è¯•**: å„ç±»é¢„å¯†é’¥çš„ç”Ÿæˆã€ç­¾åã€éªŒè¯
- âœ… **å¯†é’¥å­˜å‚¨æµ‹è¯•**: æŒä¹…åŒ–å­˜å‚¨å’Œæ¢å¤åŠŸèƒ½
- âœ… **å¯†é’¥åŒ…æµ‹è¯•**: é¢„å¯†é’¥åŒ…çš„åˆ›å»ºå’ŒéªŒè¯

## ğŸ“š å­¦ä¹ èµ„æº

### Signal Protocol æ ¸å¿ƒæ¦‚å¿µ

1. **X3DH (Extended Triple Diffie-Hellman)**: åˆå§‹å¯†é’¥åå•†åè®®
2. **Double Ratchet**: æ¶ˆæ¯åŠ å¯†å’Œå‰å‘å®‰å…¨æ€§ç®—æ³•
3. **XEdDSA**: Ed25519 å…¼å®¹ç­¾åä½¿ç”¨ Curve25519 å¯†é’¥
4. **å‰å‘å®‰å…¨æ€§**: å†å²æ¶ˆæ¯åœ¨å¯†é’¥æ³„éœ²åä»ç„¶å®‰å…¨

### æŠ€æœ¯ç»†èŠ‚

- **Curve25519**: ç°ä»£æ¤­åœ†æ›²çº¿åŠ å¯†æ ‡å‡†
- **Ed25519**: é«˜æ€§èƒ½æ•°å­—ç­¾åç®—æ³•
- **HKDF**: åŸºäº HMAC çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°
- **AES-CTR**: æµå¼åŠ å¯†æ¨¡å¼

## ğŸ” ä»£ç è´¨é‡

- **ç±»å‹æç¤º**: å®Œæ•´çš„ Python ç±»å‹æ ‡æ³¨
- **æ–‡æ¡£å­—ç¬¦ä¸²**: è¯¦ç»†çš„ API æ–‡æ¡£
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- **æµ‹è¯•é©±åŠ¨**: é«˜æµ‹è¯•è¦†ç›–ç‡

## ğŸ› ï¸ å¼€å‘å·¥å…·é›†æˆ

- **VS Code**: å®Œæ•´çš„è°ƒè¯•å’Œå¼€å‘æ”¯æŒ
- **Git**: ç‰ˆæœ¬æ§åˆ¶å’Œå¼€å‘å†å²
- **è™šæ‹Ÿç¯å¢ƒ**: éš”ç¦»çš„ä¾èµ–ç®¡ç†
- **å‘½ä»¤è¡Œå·¥å…·**: æ”¯æŒå„ç§å¼€å‘ä»»åŠ¡

## ğŸ“‹ å¾…å®ç°åŠŸèƒ½

æŸ¥çœ‹ [DEVELOPMENT_STATUS.md](DEVELOPMENT_STATUS.md) äº†è§£è¯¦ç»†çš„å¼€å‘è¿›åº¦å’Œè®¡åˆ’ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ é¡¹ç›®ï¼Œæ¬¢è¿ï¼š
- æå‡ºé—®é¢˜å’Œå»ºè®®
- æ”¹è¿›ä»£ç å®ç°
- å¢åŠ æµ‹è¯•ç”¨ä¾‹
- å®Œå–„æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ Signal Foundation å’Œå¼€æºç¤¾åŒºä¸ºç«¯åˆ°ç«¯åŠ å¯†é€šä¿¡åšå‡ºçš„è´¡çŒ®ã€‚

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ å®ç°ï¼Œä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å¦‚éœ€åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ Signal Protocolï¼Œè¯·ä½¿ç”¨å®˜æ–¹çš„ libsignal åº“ã€‚