# Signal Protocol åŒ…å¼€å‘è§„èŒƒæ€»ç»“

> **åˆ›å»ºæ—¥æœŸ**: 2025å¹´7æœˆ25æ—¥  
> **ç›®çš„**: æ€»ç»“æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç¡®ç«‹çš„åŒ…ç»„ç»‡å’Œæµ‹è¯•è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒå¼€å‘ç†å¿µ

### 1. ç®€æ´æ€§ä¼˜å…ˆ (Simplicity First)
- **ç©º `__init__.py`**: æ‰€æœ‰åŒ…çš„ `__init__.py` æ–‡ä»¶ä¿æŒä¸ºç©ºæˆ–åªåŒ…å«æ³¨é‡Š
- **æ˜ç¡®å¯¼å…¥**: ä½¿ç”¨å®Œæ•´çš„æ¨¡å—è·¯å¾„ï¼Œé¿å…éšå¼å¯¼å…¥
- **èŒè´£å•ä¸€**: æ¯ä¸ªæ¨¡å—ä¸“æ³¨äºå•ä¸€åŠŸèƒ½

### 2. å¯ç»´æŠ¤æ€§ (Maintainability)
- **ç»“æ„é•œåƒ**: æµ‹è¯•ç»“æ„å®Œå…¨é•œåƒæºç ç»“æ„
- **ä¸€å¯¹ä¸€æ˜ å°„**: æ¯ä¸ªæºç æ¨¡å—å¯¹åº”ä¸€ä¸ªæµ‹è¯•æ¨¡å—
- **æ¸…æ™°ä¾èµ–**: ä¾èµ–å…³ç³»ä¸€ç›®äº†ç„¶ï¼Œé¿å…å¾ªç¯å¯¼å…¥

### 3. æ‰©å±•æ€§ (Scalability)
- **æ¨¡å—åŒ–è®¾è®¡**: æ–°åŠŸèƒ½å¯ä»¥è‡ªç„¶åœ°èå…¥ç°æœ‰ç»“æ„
- **å±‚æ¬¡æ¸…æ™°**: åŒ…ç»“æ„åæ˜ åŠŸèƒ½å±‚æ¬¡å…³ç³»
- **å·¥å…·æ”¯æŒ**: æä¾›è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·ç¡®ä¿è§„èŒƒéµå®ˆ

---

## ğŸ“ åŒ…ç»“æ„è®¾è®¡åŸåˆ™

### æºç åŒ…ç»“æ„
```
signal_protocol/
â”œâ”€â”€ __init__.py                    # ç©ºæ–‡ä»¶
â”œâ”€â”€ keys/                          # å¯†é’¥ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py               # ç©ºæ–‡ä»¶
â”‚   â”œâ”€â”€ identity_key.py           # èº«ä»½å¯†é’¥
â”‚   â”œâ”€â”€ key_store.py              # å¯†é’¥å­˜å‚¨
â”‚   â””â”€â”€ pre_keys/                 # é¢„å¯†é’¥å­æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py           # ç©ºæ–‡ä»¶
â”‚       â”œâ”€â”€ base_pre_key.py       # åŸºç¡€é¢„å¯†é’¥
â”‚       â”œâ”€â”€ signed_pre_key.py     # ç­¾åé¢„å¯†é’¥
â”‚       â”œâ”€â”€ one_time_pre_key.py   # ä¸€æ¬¡æ€§é¢„å¯†é’¥
â”‚       â””â”€â”€ pre_key_bundle.py     # é¢„å¯†é’¥åŒ…
â”œâ”€â”€ sessions/                      # ä¼šè¯ç®¡ç† (æœªæ¥)
â””â”€â”€ messages/                      # æ¶ˆæ¯å¤„ç† (æœªæ¥)
```

### æµ‹è¯•åŒ…ç»“æ„ (å®Œå…¨é•œåƒ)
```
tests/
â”œâ”€â”€ __init__.py                    # ç©ºæ–‡ä»¶
â””â”€â”€ signal_protocol/               # é•œåƒæºç ç»“æ„
    â”œâ”€â”€ __init__.py               # ç©ºæ–‡ä»¶
    â””â”€â”€ keys/
        â”œâ”€â”€ __init__.py           # ç©ºæ–‡ä»¶
        â”œâ”€â”€ test_identity_key.py  # å¯¹åº” identity_key.py
        â”œâ”€â”€ test_key_store.py     # å¯¹åº” key_store.py
        â””â”€â”€ pre_keys/
            â”œâ”€â”€ __init__.py       # ç©ºæ–‡ä»¶
            â”œâ”€â”€ test_base_pre_key.py      # å¯¹åº” base_pre_key.py
            â”œâ”€â”€ test_signed_pre_key.py    # å¯¹åº” signed_pre_key.py
            â””â”€â”€ test_pre_key_bundle.py    # å¯¹åº” pre_key_bundle.py
```

---

## ğŸ”§ å…³é”®è§„èŒƒ

### 1. __init__.py æ–‡ä»¶è§„èŒƒ â­
```python
# âœ… æ­£ç¡®çš„ __init__.py å†…å®¹
# Empty __init__.py file for signal_protocol.keys package

# âŒ ç¦æ­¢çš„å†…å®¹
from .identity_key import generate_identity_key_pair  # ç¦æ­¢é‡æ–°å¯¼å‡º
from . import identity_key                            # ç¦æ­¢å­æ¨¡å—å¯¼å…¥
__all__ = ['identity_key']                           # ç¦æ­¢ __all__ å®šä¹‰
```

### 2. å¯¼å…¥è§„èŒƒ
```python
# âœ… æ­£ç¡®çš„å¯¼å…¥æ–¹å¼
from signal_protocol.keys.identity_key import generate_identity_key_pair
from signal_protocol.keys.pre_keys.base_pre_key import PreKeyPair

# âŒ ç¦æ­¢çš„å¯¼å…¥æ–¹å¼
from signal_protocol.keys import generate_identity_key_pair  # é¿å…ä»åŒ…å¯¼å…¥
from signal_protocol import keys                             # é¿å…å¯¼å…¥æ•´ä¸ªåŒ…
from signal_protocol.keys import *                          # ç¦æ­¢é€šé…ç¬¦å¯¼å…¥
```

### 3. æµ‹è¯•æ–‡ä»¶ç»„ç»‡
```python
# æ–‡ä»¶: tests/signal_protocol/keys/test_identity_key.py
import unittest
from signal_protocol.keys.identity_key import (  # ä½¿ç”¨å®Œæ•´è·¯å¾„
    IdentityKeyPair,
    generate_identity_key_pair
)

class TestIdentityKey(unittest.TestCase):
    """æµ‹è¯•èº«ä»½å¯†é’¥åŸºç¡€åŠŸèƒ½"""

    def test_identity_key_creation(self):
        """æµ‹è¯•èº«ä»½å¯†é’¥åˆ›å»º"""
        pass

if __name__ == '__main__':
    unittest.main()
```

### 4. æ¨¡å—æµ‹è¯•è§„èŒƒ â­ æ¨èå®è·µ
æ¯ä¸ªæºç æ¨¡å—éƒ½åº”è¯¥åŒ…å«`if __name__ == "__main__"`æµ‹è¯•éƒ¨åˆ†ï¼š

```python
# æ–‡ä»¶: signal_protocol/keys/identity_key.py

# ... æ¨¡å—çš„ä¸»è¦ä»£ç  ...

if __name__ == "__main__":
    """
    æ¨¡å—çš„ç®€è¦æµ‹è¯•å’Œæ¼”ç¤ºã€‚

    è¿è¡Œæ–¹å¼: python -m signal_protocol.keys.identity_key
    """
    print("ğŸ”‘ Testing identity key functionality...")

    # åŸºæœ¬åŠŸèƒ½æµ‹è¯•
    key_pair = generate_identity_key_pair()
    print(f"âœ… Generated key pair: {key_pair.public_key_bytes.hex()[:16]}...")

    # åŠŸèƒ½éªŒè¯
    test_message = b"Hello, Signal Protocol!"
    signature = xeddsa_sign(key_pair, test_message)
    is_valid = xeddsa_verify(key_pair.ed25519_verify_key_bytes, test_message, signature)

    assert is_valid, "Signature should be valid"
    print("âœ… XEdDSA signing and verification works!")

    print("ğŸ‰ All tests passed!")
```

#### æ¨¡å—æµ‹è¯•çš„å¥½å¤„
- **å¿«é€ŸéªŒè¯**: ç›´æ¥è¿è¡Œæ¨¡å—éªŒè¯åŠŸèƒ½
- **ä½¿ç”¨ç¤ºä¾‹**: å±•ç¤ºæ¨¡å—çš„æ ¸å¿ƒç”¨æ³•
- **å¼€å‘è°ƒè¯•**: ä¾¿äºå¼€å‘æ—¶å¿«é€Ÿæµ‹è¯•
- **æ´»æ–‡æ¡£**: ä½œä¸ºå¯æ‰§è¡Œçš„ä½¿ç”¨æ–‡æ¡£

---

## ğŸ› ï¸ å¼€å‘å·¥å…·

### 1. æµ‹è¯•è¿è¡Œå™¨
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python run_tests.py

# ä½¿ç”¨ Make å‘½ä»¤
make test
```

### 2. ä»£ç è´¨é‡æ£€æŸ¥
```bash
# åŸºç¡€æ£€æŸ¥ (ä¸éœ€è¦å¤–éƒ¨å·¥å…·)
python scripts/basic_check.py
make check

# å®Œæ•´æ£€æŸ¥ (éœ€è¦å¼€å‘å·¥å…·)
python scripts/check_code_quality.py
make quality-check
```

### 3. å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å®‰è£…å¼€å‘ä¾èµ–
make install-dev

# åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ
make setup
```

---

## âœ… è‡ªåŠ¨åŒ–æ£€æŸ¥

æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–æ£€æŸ¥åŒ…æ‹¬ï¼š

### 1. é¡¹ç›®ç»“æ„æ£€æŸ¥
- éªŒè¯å¿…éœ€æ–‡ä»¶å­˜åœ¨
- æ£€æŸ¥ç›®å½•ç»“æ„å®Œæ•´æ€§

### 2. __init__.py è§„èŒƒæ£€æŸ¥
- ç¡®ä¿æ‰€æœ‰ `__init__.py` æ–‡ä»¶ä¸ºç©ºæˆ–åªåŒ…å«æ³¨é‡Š
- æ£€æµ‹è¿åè§„èŒƒçš„å¯¼å…¥

### 3. å¯¼å…¥é£æ ¼æ£€æŸ¥
- æ£€æµ‹ä»åŒ…çº§åˆ«çš„å¯¼å…¥
- å‘ç°é€šé…ç¬¦å¯¼å…¥
- éªŒè¯ä½¿ç”¨å®Œæ•´æ¨¡å—è·¯å¾„

### 4. æ¨¡å—æµ‹è¯•æ£€æŸ¥
- æ£€æŸ¥æ¯ä¸ªæ¨¡å—æ˜¯å¦åŒ…å« `if __name__ == "__main__"` æµ‹è¯•
- ç»Ÿè®¡æ¨¡å—æµ‹è¯•è¦†ç›–ç‡
- æä¾›æ”¹è¿›å»ºè®®

### 5. æµ‹è¯•å®Œæ•´æ€§
- è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
- éªŒè¯æµ‹è¯•è¦†ç›–ç‡

---

## ğŸ¯ éµå¾ªè¿™äº›è§„èŒƒçš„å¥½å¤„

### 1. é¿å…å¸¸è§é—®é¢˜
- **å¾ªç¯å¯¼å…¥**: ç©ºçš„ `__init__.py` é¿å…å¤æ‚çš„å¯¼å…¥ä¾èµ–
- **éšå¼ä¾èµ–**: æ˜ç¡®çš„å¯¼å…¥è·¯å¾„ä½¿ä¾èµ–å…³ç³»æ¸…æ™°
- **å‘½åå†²çª**: å®Œæ•´è·¯å¾„é¿å…åç§°ç©ºé—´æ±¡æŸ“

### 2. æé«˜å¯ç»´æŠ¤æ€§
- **æ˜“äºé‡æ„**: ç§»åŠ¨æ¨¡å—æ—¶ä¸éœ€è¦æ›´æ–° `__init__.py`
- **æ¸…æ™°ç»“æ„**: æµ‹è¯•ç»“æ„é•œåƒæºç ï¼Œæ˜“äºå®šä½
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„è§„èŒƒå‡å°‘è®¤çŸ¥è´Ÿæ‹…

### 3. ä¾¿äºå›¢é˜Ÿåä½œ
- **æ˜ç¡®è§„èŒƒ**: è¯¦ç»†çš„æ–‡æ¡£å’Œè‡ªåŠ¨åŒ–æ£€æŸ¥
- **å·¥å…·æ”¯æŒ**: è‡ªåŠ¨åŒ–å·¥å…·ç¡®ä¿è§„èŒƒéµå®ˆ
- **æ¸è¿›å¼**: å¯ä»¥é€æ­¥æ·»åŠ æ–°åŠŸèƒ½è€Œä¸ç ´åç°æœ‰ç»“æ„

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å¼€å‘è§„èŒƒ](./DEVELOPMENT_GUIDELINES.md) - è¯¦ç»†çš„å¼€å‘æŒ‡å—
- [é¡¹ç›®README](../README.md) - é¡¹ç›®æ¦‚è¿°å’Œä½¿ç”¨è¯´æ˜
- [å¼€å‘çŠ¶æ€](../DEVELOPMENT_STATUS.md) - å½“å‰å¼€å‘è¿›åº¦

---

## ğŸ”„ æŒç»­æ”¹è¿›

è¿™äº›è§„èŒƒæ˜¯åŸºäºæˆ‘ä»¬çš„å®é™…å¼€å‘ç»éªŒæ€»ç»“çš„ï¼Œä¼šéšç€é¡¹ç›®çš„å‘å±•è€Œä¸æ–­å®Œå–„ï¼š

1. **å®šæœŸå®¡æŸ¥**: æ¯ä¸ªå¼€å‘é˜¶æ®µç»“æŸåå®¡æŸ¥è§„èŒƒçš„æœ‰æ•ˆæ€§
2. **å·¥å…·æ”¹è¿›**: æŒç»­æ”¹è¿›è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·
3. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°æ–‡æ¡£ä»¥åæ˜ æœ€æ–°çš„æœ€ä½³å®è·µ

**è®°ä½**: è§„èŒƒçš„ç›®çš„æ˜¯æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ï¼Œè€Œä¸æ˜¯é™åˆ¶åˆ›æ–°ã€‚åœ¨ç‰¹æ®Šæƒ…å†µä¸‹å¯ä»¥çµæ´»å¤„ç†ï¼Œä½†éœ€è¦åœ¨ä»£ç å®¡æŸ¥ä¸­è¯´æ˜åŸå› ã€‚
